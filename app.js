!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){"use strict";b.exports=function(a){a.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){c.html5Mode({enabled:!0,requireBase:!1}),c.hashPrefix("!"),a.state("home",{url:"/",controller:"HomeController",templateUrl:"/views/pages/home.html",resolve:{HomeData:["DataService",function(a){return a.query({query:"estados"})}]}}).state("home.filter",{url:"dados/:group/:item/"}).state("estado",{url:"/uf/:id/",controller:"SingleEstadoController",templateUrl:"/views/estado/single.html",resolve:{EstadoData:["$q","$stateParams","DataService",function(a,b,c){var d=[],e=[{query:"estados",id:b.id},{estado_id:b.id,limit:-1}];return angular.forEach(e,function(a){d.push(c.query(a))}),a.all(d)}]}}).state("estado.filter",{url:"dados/:group/:item/"}).state("estado.cidade",{url:"cidade/:cityId/"}).state("estado.cidade.filter",{url:"dados/:group/:item/"}),b.rule(function(a,b){var c,d=b.path(),e=b.search();if("/"!==d[d.length-1])return 0===Object.keys(e).length?d+"/":(c=[],angular.forEach(e,function(a,b){c.push(b+"="+a)}),d+"/?"+c.join("&"))})}]),a.run(["$rootScope","$location","$window",function(a,b,c){a.$on("$stateChangeSuccess",function(a,b,c,d){setTimeout(function(){d.name&&"home.filter"!==d.name&&"home.filter"==b.name||"estado.filter"!==d.name&&"estado.filter"==b.name?$("html,body").animate({scrollTop:$("#data").offset().top-60},500):"home.filter"!==b.name&&"estado.filter"!==b.name&&(d.name||$(window).scrollTop()>$(window).height()-60)&&$("html,body").animate({scrollTop:$(window).height()-60},500)},200)}),a.$on("$stateChangeSuccess",function(){c._gaq&&c._gaq.push(["_trackPageview",b.path()])})}])}},{}],2:[function(a,b,c){"use strict";b.exports=function(a){a.controller("MainCtrl",["$scope","$location",function(a,b){a.iframe=window.self!==window.top,a.theme=b.search().theme,a.lock=b.search().lock,a.hideTitle=b.search().hide_title}]),a.controller("FiltersController",["ngDialog","$scope",function(a,b){b.itemDetails=function(c){b.detailGroup=c,a.open({template:"/views/details.html",scope:b})}}]),a.controller("HomeController",["HomeData","AvailableGroups","GroupedFilter","$timeout","$state","$stateParams","$scope",function(a,b,c,d,e,f,g){if(g.iframe=window.self!==window.top,g.selectGroup=function(a){var b=!0,c=null;"_%"==a.abstraction&&(b=!1),"_pcmh"==a.abstraction&&(c="/100 mil hab."),g.group=_.extend(a,{useMax:b,suffix:c})},g.groups={},angular.forEach(b,function(b){g.groups[b.name]=_.extend(b,c(a.data,b.selections,b.abstraction,b.raw))}),g.selectGroup({}),e.params.item){var h=_.find(g.groups,function(a){return a.name==e.params.group});h.changeSelection(_.find(h.selections,function(a){return a.key==e.params.item})),g.selectGroup(h)}else d(function(){g.selectGroup(g.groups.abastecimento)},50);g.$watch("group",function(a,b){b.selection&&e.go("home.filter",{group:a.name,item:a.selection.key})},!0),g.map=!1,g.$on("cartodbFeatureOver",function(a,b){var c=_.find(g.groups,function(a){return a.name==b.id});c&&(b.value?("_%"==c.abstraction&&(b.value=(100*b.value).toFixed(2)+"%"),g.$apply(function(){g.map=b})):g.$apply(function(){g.map=!1}))}),g.$on("cartodbFeatureOut",function(a,b){g.$apply(function(){g.map=!1})})}]),a.controller("EstadoController",["$state","$scope",function(a,b){b.accessUF=function(b){a.go("estado",{id:b})},b.accessUFGroup=function(b,c){a.go("estado.filter",{id:b,group:c.name,item:c.selection.key})}}]),a.controller("SingleEstadoController",["EstadoData","AvailableGroups","GroupedFilter","$timeout","$state","$stateParams","$scope",function(a,b,c,d,e,f,g){if(g.estado=a[0].data[0],g.order="value",g.changeOrder=function(a){g.order=a},g.selectGroup=function(a){var b=!0,c=null;"_%"==a.abstraction&&(b=!1),"_pcmh"==a.abstraction&&(c="/100 mil hab."),g.group=_.extend(a,{useMax:b,suffix:c})},g.groups={},angular.forEach(b,function(b){g.groups[b.name]=_.extend(b,c(a[1].data,b.selections,b.abstraction,b.raw))}),g.selectGroup({}),e.params.item){var h=_.find(g.groups,function(a){return a.name==e.params.group});h.changeSelection(_.find(h.selections,function(a){return a.key==e.params.item})),g.selectGroup(h)}else d(function(){g.selectGroup(g.groups.abastecimento)},100);g.limitCities=10,g.goHome=function(a){e.go("home.filter",{group:a.name,item:a.selection.key})},g.$watch("group",function(a,b){var c="estado.filter";-1!==e.current.name.indexOf("cidade")&&(c="estado.cidade.filter"),b.selection&&e.go(c,{id:g.estado.id,group:a.name,item:a.selection.key}),e.params.cityId&&(g.city=_.find(g.group.data,function(a){return a.id==e.params.cityId}),g.limitCities=5)},!0),g.map=!1,g.$on("cartodbFeatureOver",function(a,b){var c=_.find(g.groups,function(a){return a.name==b.id});c&&(b.value?("_%"==c.abstraction&&(b.value=(100*b.value).toFixed(2)+"%"),g.$apply(function(){g.map=b})):g.$apply(function(){g.map=!1}))}),g.$on("cartodbFeatureOut",function(a,b){g.$apply(function(){g.map=!1})})}])}},{}],3:[function(a,b,c){"use strict";function d(a){a=a.replace("#","");var b=parseInt(a,16),c=b>>16&255,d=b>>8&255,e=255&b;return[c,d,e].join(",")}function e(a,b){setTimeout(function(){a.invalidateSize(!1),a.fitBounds(b)},100)}function f(a,b,c,e){var f=d(b),g=["#"+a+" { polygon-fill: transparent; polygon-opacity: 1; line-width: 1; line-opacity: 0.5; line-color: #000; }","#"+a+"[ value <= 0 ] { polygon-fill: transparent; }"];return _.each(c,function(b,c){g.push("#"+a+"[ value >= "+b+" ] { polygon-fill: rgba("+f+", "+(c+1)/10+");  }")}),e&&g.push("#"+a+'[ co_ibge3 = "'+e+'" ] { line-width: 2; line-color: #fff; line-opacity: 1; }'),g.join(" ")}function g(a,b,c,d){a.execute("SELECT CDB_HeadsTailsBins(array_agg(cast("+c+" as numeric)), 10) FROM "+b).done(function(a){var b=a.rows[0].cdb_headstailsbins;d(b)})}function h(a,b,c){var a=a||{};a=_.extend({countTo:0,value:0,duration:1e3},a);var d,e,f,g,h,i,j=function(){e=30,g=0,i=null,a.countTo=parseFloat(a.countTo)||0,a.value=parseFloat(a.value)||0,a.duration=parseInt(a.duration)||500,f=Math.ceil(a.duration/e),h=(a.countTo-a.value)/f,d=a.value},k=function(){i=setTimeout(function(){d+=h,g++,g>=f?(clearTimeout(i),d=a.countTo,"function"==typeof c&&c(a.countTo)):("function"==typeof b&&b(d,a.countTo),k())},e)};return function(b,c){a.countTo=b||a.countTo,a.value=c||0,i&&clearTimeout(i),j(),k()}}b.exports=function(a){a.directive("animateCount",[function(){return{link:function(a,b,c){var d,e,f=function(){d=b.offset().top,e=$(window).height()};f();var g=function(a){return c.prefix&&(a=c.prefix+a),c.suffix&&(a+=c.suffix),a},i=h({countTo:c.number},function(a){b.text(g(a.toFixed(2)))},function(a){b.text(g(a))}),j=!1,k=function(){var a=$(window).scrollTop();a+e>=d&&!j&&(j=!0,i(),c.$observe("number",function(a){i(a)}))};k(),$(window).scroll(k)}}}]),a.directive("barItem",["$rootScope",function(a){return{restrict:"E",scope:{data:"="},transclude:!0,template:'<div class="data-rep"></div><div class="data-info"><p class="percentage"></p></div>',link:function(b,c,d,e,f){f(b,function(a,b){c.find(".data-info").append(a)});var g,i,j=d.suffix||"%",k=function(){g=c.offset().top,i=$(window).height()},l=function(a){return d.max&&(a=parseFloat(a)/parseFloat(d.max)*100),a+"%"};k();var m=h({countTo:d.percentage},function(a,b){c.find(".data-rep").css({width:l(b)}),c.find(".percentage").html(a.toFixed(2)+'<span class="suffix">'+j+"</span>")},function(a){c.find(".percentage").html(a+'<span class="suffix">'+j+"</span>")});$(window).resize(k);var n=!1,o=function(){var b=$(window).scrollTop();b+i>=g&&!n&&(n=!0,m(),a.$broadcast("barItemStartedAnimation"))};o(),$(window).scroll(o)}}}]),a.directive("map",["$rootScope",function(a){return{restrict:"E",link:function(b,c,d){function h(){i.addLayer(L.tileLayer(d.baselayer));var b=new cartodb.SQL({user:d.user}),c="SELECT "+d.column+" as value, * FROM "+d.table;d.where&&(c+=" WHERE "+d.where);var h="";h=d.city?c+" AND co_ibge3 = '"+d.city+"'":c,g(b,d.table,d.column,function(k){b.getBounds(h).done(function(h){a.$broadcast("cartodbMapReady",{id:d.group,map:i,bounds:h});var l=f(d.table,d.color,k,d.city);cartodb.createLayer(i,{user_name:d.user,type:"cartodb",sublayers:[{sql:c,cartocss:l,interactivity:d.interactivity||"value"}],options:{tooltip:!0}}).addTo(i).done(function(c){e(i,h);var l=c.getSubLayer(0),m=_.debounce(function(){g(b,d.table,d.column,function(a){k=a,l.set({cartocss:f(j,d.color,k,d.city)});var b="SELECT "+d.column+" as value, * FROM "+j;d.where&&(b+=" WHERE "+d.where),l.set({sql:b})})},100);d.$observe("group",m),d.$observe("column",m),d.$observe("color",m),l.setInteraction(!0),c.on("featureOver",function(b,c,e,f,g){a.$broadcast("cartodbFeatureOver",_.extend({id:d.group},f))}),c.on("featureOut",function(b){a.$broadcast("cartodbFeatureOver",{id:d.group})})})})})}var i=L.map(c[0],{center:[0,0],zoom:1,scrollWheelZoom:!1,infowindow:!0}),j=(d.user||"infoamazonia",d.table||"merge_fiocruz_amz"),k=(d.column||"agua_rede_",d.color||"transparent",d.city||"",_.once(function(){h()}));d.$observe("column",function(){d.column&&k()})}}}])}},{}],4:[function(a,b,c){"use strict";b.exports=function(a){a.filter("hideEmpty",[function(){return function(a,b){return b?_.filter(a,function(a){return a[b]}):a}}])}},{}],5:[function(a,b,c){"use strict";var d=angular.module("visaguas",["ui.router","ngDialog"]);a("./config")(d),a("./services")(d),a("./controllers")(d),a("./directives")(d),a("./filters")(d),angular.bootstrap(document,["visaguas"]),a("./ui")()},{"./config":1,"./controllers":2,"./directives":3,"./filters":4,"./services":6,"./ui":7}],6:[function(a,b,c){"use strict";b.exports=function(a){a.factory("DataService",["$http","$q",function(a,b){var c=function(b,c){b=b||{},a({method:"GET",url:"/api",params:b}).success(function(a){c(a)})};return{query:function(a){var d=b.defer();return c(a,function(a){d.resolve(a)}),d.promise}}}]),a.factory("AvailableGroups",[function(){return[{title:"Abastecimento de água",name:"abastecimento",abstraction:"_%",raw:"dpp",color:"#0000ff",measureDesc:"Medição por porcentagem de domicílios particulares permanentes",selections:[{name:"Rede geral",key:"agua_rede_geral",mapKey:"agua_rede_",text:"das residências com abastecimento de água pela rede geral",desc:"Quando o domicílio ou o terreno, ou a propriedade onde estava localizado, estava ligado a uma rede geral de distribuição de água."},{name:"Poço ou nascente",key:"agua_poco_nascente",mapKey:"agua_poco_",text:"das residências com abastecimento de água por poço ou nascente",desc:"Quando o domicílio era servido por água proveniente de poço ou nascente localizado no terreno ou na propriedade onde estava construído."},{name:"Chuva armazenada em cisterna",key:"agua_cisterna",mapKey:"agua_ciste",text:"das residências com abastecimento de água por chuva armazenada em cisterna",desc:"Quando o domicílio era servido por água de chuva armazenada em cisterna, caixa de cimento etc."},{name:"Outras formas",key:"agua_outras",mapKey:"agua_outra",text:"das residências com abastecimento de água por outras formas",desc:"Quando a forma de abastecimento de água do domicílio era proveniente de poço ou nascente fora da propriedade, carro-pipa, água da chuva armazenada de outra forma, rio, açude, lago ou igarapé ou outra forma de abastecimento de água, diferente das descritas anteriormente."}]},{title:"Acesso a esgoto",name:"esgoto",abstraction:"_%",raw:"dpp",color:"#ff0000",measureDesc:"Medição por porcentagem de domicílios particulares permanentes",selections:[{name:"Rede geral",key:"esgoto_rede_geral",mapKey:"esgoto_red",text:"das residências com acesso a esgoto pela rede geral",desc:"Quando a canalização das águas servidas e dos dejetos, proveniente do banheiro ou sanitário, estava ligada a um sistema de coleta que os conduzia a um desaguadouro geral da área, região ou município, mesmo que o sistema não dispusesse de estação de tratamento da matéria esgotada."},{name:"Fossa séptica",key:"esgoto_fossa_septica",mapKey:"esgoto_fos",text:"das residências com acesso a esgoto via fossa séptica",desc:"Quando a canalização do banheiro ou sanitário estava ligada a uma fossa séptica, ou seja, a matéria era esgotada para uma fossa próxima, onde passava por um processo de tratamento ou decantação, sendo, ou não, a parte líquida conduzida em seguida para um desaguadouro geral da área, região ou município."},{name:"Fossa rudimentar",key:"esgoto_fossa_rudimentar",mapKey:"esgoto_f_1",text:"das residências com acesso a esgoto via fossa rudimentar",desc:"Quando o banheiro ou sanitário estava ligado a uma fossa rústica (fossa negra, poço, buraco, etc.)."},{name:"Vala",key:"esgoto_vala",mapKey:"esgoto_val",text:"das residências com acesso a esgoto por vala",desc:"Quando o banheiro ou sanitário estava ligado diretamente a uma vala a céu aberto."},{name:"Rio, lago ou mar",key:"esgoto_rio_lago_mar",mapKey:"esgoto_rio",text:"das residências com acesso a esgoto via rio, lago ou mar",desc:"Quando o banheiro ou sanitário estava ligado diretamente a rio, lago ou mar."},{name:"Outro",key:"esgoto_outros",mapKey:"esgoto_out",text:"das residências com acesso a esgoto por outras formas",desc:"Quando o esgotamento dos dejetos, proveniente do banheiro ou sanitário, não se enquadrasse em quaisquer dos tipos descritos anteriormente."}]},{title:"Doenças",name:"doencas",abstraction:"_pcmh",raw:"populacao",color:"#ffcc00",measureDesc:"Medição por internações por 100 mil habitantes",selections:[{name:"Amebíase",key:"amebiase",mapKey:"amebiase_p",text:"internações por 100 mil habitantes"},{name:"Cólera",key:"colera",mapKey:"colera_pcm",text:"internações por 100 mil habitantes"},{name:"Dengue",key:"dengue",mapKey:"dengue_pcm",text:"internações por 100 mil habitantes"},{name:"Esquistossomose",key:"esquistossomose",mapKey:"esquistoss",text:"internações por 100 mil habitantes"},{name:"Filariose",key:"filariose",mapKey:"filariose",text:"internações por 100 mil habitantes"},{name:"Leptospirose",key:"leptospirose",mapKey:"leptospiro",text:"internações por 100 mil habitantes"},{name:"Febre tifóide",key:"tifoide",mapKey:"tifoide",text:"internações por 100 mil habitantes"}]}]}]),a.factory("GroupedFilter",[function(){return function(a,b,c,d){c=c||"_%",d=d||"dpp";var e={dpp:0,populacao:0};angular.forEach(a,function(a){e.dpp+=parseInt(a.domicilios_particulares_permanentes),e.populacao+=parseInt(a["população"])});var f={data:[],total:0,selections:b,selection:b[0],changeSelection:function(b){this.selection=b;var f=[],g=0;angular.forEach(a,function(a){g+=parseInt(a[b.key]);var d=parseFloat(a[b.key+c]);"_%"==c&&(d=100*d),d=parseFloat(d.toFixed(2)),a.municipio_id?f.push({id:a.municipio_id,municipio:a.municipio,value:d}):f.push({id:a.id,estado:a.estado,municipios:a.total_municipios,value:d})}),this.total=g/e[d],"_%"==c?this.total=100*this.total:"_pcmh"==c&&(this.total=100*this.total*1e3),this.total=parseFloat(this.total.toFixed(2)),this.data=f,this.max=_.max(this.data,function(a){return parseFloat(a.value)})}};return f.changeSelection(b[0]),f}}])}},{}],7:[function(a,b,c){"use strict";b.exports=function(){$(document).ready(function(){var a=$("html"),b=$("#masthead"),c=b.find("h1"),d=c.offset().top,e=$(window).height();$(window).resize(function(){e=$(window).height()}),$(window).scroll(function(){var f=$(window).scrollTop();f>=d?(b.addClass("title-fixed"),c.addClass("fixed")):(b.removeClass("title-fixed"),c.removeClass("fixed")),f>=e-60?(a.css({"padding-top":e}),b.addClass("fixed")):(a.css({"padding-top":"0"}),b.removeClass("fixed"))})})}},{}]},{},[5]);